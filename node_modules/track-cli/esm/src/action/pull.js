import * as dntShim from "../../_dnt.shims.js";
import { load as loadConfig, save as saveConfig, } from "../shared/config.js";
import { archiveExistingChallengeFiles, downloadChallengeFilesTo, getCommonChallengeContext, trackClientFromConfig, } from "../shared/mod.js";
export async function pull() {
    const config = await loadConfig();
    const api = trackClientFromConfig(config);
    const [codingContext, _challenge] = await getCommonChallengeContext(config, api);
    const configLang = config.programmingLanguage;
    const currentLang = codingContext.selectedLanguage;
    const currentDir = dntShim.Deno.cwd();
    if (configLang && currentLang && configLang !== currentLang) {
        console.log("Your programming language has changed elsewhere since you last ran this challenge");
        await archiveExistingChallengeFiles(config.orgName);
        const updatedConfig = Object.assign({}, config, {
            programmingLanguage: currentLang,
        });
        await saveConfig(updatedConfig);
    }
    const showFileDiff = true;
    const includeTarball = false;
    await downloadChallengeFilesTo(codingContext, currentDir, api, showFileDiff, includeTarball);
}
